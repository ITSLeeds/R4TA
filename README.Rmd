---
output: github_document
bibliography: references.bib
---

Welcome to R for Transport Applications. 

Comments, slide and links from the course can be found here.

## Slides

The basis of the course is a series of slides in html, generated by RMarkdown.
The source of the slides can be found here: https://github.com/ITSLeeds/R4TA/tree/master/slides 

The most important of these is the slides introducing the course and linking it together, which can be found here (challenge: try to reproduce these by 'knitting' the source code found in the previous link):

- 

## Links

- [Gecomputation with R](http://geocompr.robinlovelace.net/) [@lovelace_geocomputation_2018]
- [R for Data Science](http://r4ds.had.co.nz/) [@grolemund_r_2016-1]
- [Efficient R Programming](https://csgillespie.github.io/efficientR/) [@gillespie_efficient_2016]
- [sf](https://cran.r-project.org/web/packages/sf/vignettes/) package vignettes (see also `vignette(package = "sf")`)
- [dodgr website](https://atfutures.github.io/dodgr/) (contains vignettes)
- [tutorial by Mark Padgham](https://github.com/mpadge/r4trans-april18/blob/master/bristol.Rmd)

## Notes from day 1

```{r}
# demonstration of key.pos
library(sf)
library(spData)
plot(world["pop"])
plot(world["pop"], key.pos = 3)
# for more info see:
# https://cran.r-project.org/web/packages/sf/vignettes/sf5.html
# vignette("sf")
?sf::plot
```

Demonstration of sfc to sf conversion:

```{r}
asia = world[world$continent == "Asia", ]
asia = st_union(asia)
class(asia)
asia_df = st_sf(
  data.frame(name = "asia"),
  geometry = asia
  )
class(asia_df)
```

Reading-in data - see Chapter 6 of Geocomputation with R.

```{r, eval=FALSE}
# api keys - don't use:
cyclestreets::journey(from, to, pat = "ldkjfa;ldkjfasd")
# do use:
usethis::edit_r_environ()
Sys.getenv("CYCLESTREET")
# from a file:
# u = "https://github.com/martinjc/UK-GeoJSON/blob/master/json/eurostat/sco/topo_nuts2.json"
# download.file(u, "scot.geojson") # download
```

```{r, eval=FALSE}
lnd = read_sf("~/repos/Creating-maps-in-R/data/lnd.geojson")
class(lnd)
write_sf(lnd, "lnd.geojson")
saveRDS()
write_rds(lnd, "lnd.rds")
file.size("lnd.geojson") / 1e6
file.size("lnd.rds") / 1e6
plot(lnd)
library(osmdata)
q = opq(bbox = "Leeds") %>% 
  add_osm_feature("leisure", value = "park")
res = osmdata_sf(q = q)
plot(res$osm_lines$geometry)
```

## Working with OD data



```{r, eval=FALSE}
library(stplanr)
data(package = "stplanr")
class(cents_sf)
plot(cents_sf)
head(flow[1:3])
l = od2line(flow = flow, zones = cents_sf)
class(l)
plot(l)
# visualise the result:
m = mapview::mapview(l)
names(m@map)
class(m@map)
htmlwidgets::saveWidget(m@map, "map.html")

# save distance:
library(sf)
l_length = st_length(l)
class(l_length)
l_length = as.numeric(l_length)
l$length = l_length
plot(l)
plot(l$geometry)
```

## Route nets

```{r, eval=FALSE}
l = od2line(flow[2:9,], cents_sf)
r = line2route(l)
plot(r)

devtools::install_github("robinlovelace/cyclestreets")
from = stplanr::geo_code("leeds")
to = stplanr::geo_code("Bradford")
r = cyclestreets::journey(from, to)
?spDataLarge::bristol_zones
?cyclestreets::json2sf_cs
plot(r)
r_osrm = stplanr::route_osrm("Leeds", "Bradford uk")
plot(r_osrm)
```

```{r, eval=FALSE}
library(tmap)
library(spDataLarge)
qtm(bristol_zones)
bristol_zones$random = 
  runif(n = nrow(bristol_zones))

tm_shape(bristol_zones) +
  tm_fill(col = "random") +
  tm_borders() +
  tm_style_col_blind() +
  tm_layout()
```



In order to help improve the course in the future, please provide feedback via this online form:

https://leeds.onlinesurveys.ac.uk/r-for-transport-applications-27th-27th-apr-2018

## References
